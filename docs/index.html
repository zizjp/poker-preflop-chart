<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>レンジ可視化（8-max / BBアンティ）</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
<header>
  <div class="wrap">
    <div class="row" role="toolbar" aria-label="ヘッダー操作">
      <h1>ポーカートーナメント レンジ可視化</h1>

      <label>スタック
        <select id="stackSel" aria-label="スタック選択"></select>
      </label>

      <label>ポジション
        <select id="posSel" aria-label="ポジション選択"></select>
      </label>

      <div class="seg" role="tablist" aria-label="表示モード">
        <button id="tabOpen" role="tab" aria-pressed="true">オープンレンジ</button>
        <button id="tabVs3" role="tab" aria-pressed="false">3bet対応</button>
        <button id="tabOverview" role="tab" aria-pressed="false">総覧（ポジ別）</button>
      </div>

      <label id="oppWrap" style="display:none;">3bet元
        <select id="oppSel" aria-label="3bet元ポジション選択"></select>
      </label>

      <div class="spacer"></div>
    </div>
  </div>
</header>

<!-- 使い方 -->
<section class="wrap help" aria-label="使い方">
  <details id="helpDetails">
    <summary>使い方（クリックで開閉）</summary>
    <div class="tips">
      <ul>
        <li>上部で <b>スタック/ポジション/表示モード</b> を切替。</li>
        <li>「3bet対応」では <b>3bet元</b> も選択。</li>
        <li>セルをタップ/Enterで、そのハンドの <b>サマリーポップ</b> を表示。</li>
        <li>右パネルで <b>現在のレンジ一覧</b> と <b>メモ</b>（保存可）。</li>
        <li>Import/Export で JSON を読み書き（不正JSONはエラー表示）。</li>
        <li>「総覧（ポジ別）」は、選択スタックで <b>一番前のポジション</b>からオープンできる色で塗り分け。</li>
      </ul>
      <p><b>キーボード</b>：←→↑↓ 移動 / Enter or Space 詳細 / Esc クローズ</p>
      <p>未定義はUI上 <b>fold</b> 扱い（薄色表示）。</p>
    </div>
  </details>
</section>

<main class="wrap" id="main">
  <!-- ハンドグリッド -->
  <section class="grid-wrap" id="gridWrap" aria-label="ハンドグリッド">
    <div class="matrix" id="matrix" role="grid" aria-rowcount="14" aria-colcount="14"></div>

    <!-- 凡例：アクション -->
    <div class="legend" id="legendAction" aria-label="凡例">
      <span class="badge"><span class="dot open" aria-hidden="true"></span>オープン（2BB）</span>
      <span class="badge"><span class="dot fold" aria-hidden="true"></span>3bet来たら降り</span>
      <span class="badge"><span class="dot call" aria-hidden="true"></span>3bet来たらコール</span>
      <span class="badge"><span class="dot jam" aria-hidden="true"></span>3bet来たら4bet jam</span>
      <span class="badge"><span class="dot undef" aria-hidden="true"></span>未定義=フォールド</span>
    </div>

    <!-- 凡例：総覧 -->
    <div class="legend" id="legendOverview" style="display:none;">
      <span class="badge"><span class="dot" style="background:var(--p-utg);border-color:var(--p-utg);"></span>UTG</span>
      <span class="badge"><span class="dot" style="background:var(--p-ep);border-color:var(--p-ep);"></span>UTG+1 / MP</span>
      <span class="badge"><span class="dot" style="background:var(--p-ljh);border-color:var(--p-ljh);"></span>HJ</span>
      <span class="badge"><span class="dot" style="background:var(--p-co);border-color:var(--p-co);"></span>CO</span>
      <span class="badge"><span class="dot" style="background:var(--p-btn);border-color:var(--p-btn);"></span>BTN</span>
      <span class="badge"><span class="dot" style="background:var(--p-sb);border-color:var(--p-sb);"></span>SB</span>
      <span class="badge"><span class="dot" style="background:var(--p-bb);border-color:var(--p-bb);"></span>BB</span>
      <span class="badge"><span class="dot" style="background:var(--p-empty);border-color:var(--border);"></span>どこもオープンしない</span>
    </div>
  </section>

  <!-- サマリ & メモ -->
  <section class="two" aria-label="サマリーとメモ">
    <div class="panel">
      <h2>レンジ一覧（現在の表示）</h2>
      <div id="rangeList" class="mono list" aria-live="polite"></div>
    </div>
    <div class="panel">
      <h2>レンジの考え方（メモ）</h2>
      <textarea id="noteBox" placeholder="このスタック/ポジション/状況の意図や方針をメモ（保存されます）"></textarea>
      <div class="ops">
        <button id="saveNoteBtn">メモ保存</button>
        <button id="exportBtn">Export JSON</button>
        <input id="importFile" class="file" type="file" accept="application/json" />
        <button id="importBtn">Import JSON</button>
      </div>
      <div id="msg" class="mono msg"></div>
    </div>
  </section>
</main>

<!-- ポップオーバー -->
<div class="popover" id="popover" role="dialog" aria-modal="false" aria-live="polite"></div>

<noscript>
  <div style="padding:12px;color:#b91c1c">JavaScriptを有効にしてください。</div>
</noscript>

<script src="./app.js"></script>
</body>
</html>
