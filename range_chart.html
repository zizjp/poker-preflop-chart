
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ポーカー戦略チャート</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    select, button {
      margin: 5px;
      padding: 6px 10px;
    }
    .button-group button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .popup {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
<h1>♠️ GTOレンジチャート</h1>

<div>
  <label>ポジション:
    <select id="position">
      <option value="UTG">UTG</option>
      <option value="HJ">HJ</option>
      <option value="CO">CO</option>
      <option value="BTN" selected>BTN</option>
      <option value="SB">SB</option>
      <option value="BB">BB</option>
    </select>
  </label>

  <label>スタック:
    <select id="stack">
      <option value="15">15BB</option>
      <option value="30">30BB</option>
      <option value="50">50BB</option>
      <option value="100" selected>100BB</option>
    </select>
  </label>

  <label>アクション:
    <select id="actionType" onchange="updateVsPositionVisibility()">
      <option value="open">オープン</option>
      <option value="3bet">3ベット</option>
      <option value="call">コールドコール</option>
      <option value="defend">ディフェンス</option>
    </select>
  </label>

  <label id="vsWrapper">相手のポジション:
    <select id="vsPosition">
      <option value="UTG">UTG</option>
      <option value="HJ">HJ</option>
      <option value="CO">CO</option>
      <option value="BTN">BTN</option>
      <option value="SB">SB</option>
      <option value="BB">BB</option>
    </select>
  </label>
</div>

<div class="button-group">
  <button id="btnTight" onclick="selectType('tight')">Tight相手</button>
  <button id="btnNormal" onclick="selectType('normal')">Normal相手</button>
  <button id="btnLoose" onclick="selectType('loose')">Loose相手</button>
</div>

<div id="resultBox"></div>
<div class="popup" id="popupBox"></div>

<script>
let rangeData = {};
let evData = {};
let currentTableHTML = "";

fetch('range_data.json').then(r => r.json()).then(json => rangeData = json);
fetch('ev_data.json').then(r => r.json()).then(json => evData = json);

function updateVsPositionVisibility() {
  const action = document.getElementById("actionType").value;
  const vsWrapper = document.getElementById("vsWrapper");
  vsWrapper.style.display = (action === "open") ? "none" : "inline";
}

function selectType(type) {
  const pos = document.getElementById("position").value;
  const stack = document.getElementById("stack").value;
  const action = document.getElementById("actionType").value;
  const vs = document.getElementById("vsPosition").value;
  const result = document.getElementById("resultBox");

  let table;
  if (action === "open") {
    table = rangeData?.[action]?.[pos]?.[stack]?.[type];
  } else {
    table = rangeData?.[action]?.[pos]?.[vs]?.[stack]?.[type];
  }

  if (!table) {
    result.innerHTML = `<p>※この条件のレンジ表は未登録です。</p>`;
    return;
  }

  const labels = ['A','K','Q','J','T','9','8','7','6','5','4','3','2'];
  let html = `<h3>${pos} / ${stack}BB / ${action}${action!=="open" ? ' vs '+vs : ''} / ${type}</h3><table border="1"><tr><th></th>`;
  html += labels.map(l => `<th>${l}</th>`).join('') + '</tr>';

  for (let i = 0; i < labels.length; i++) {
    html += `<tr><th>${labels[i]}</th>` + table[i].map(cell => {
      if (!cell) return "<td></td>";
      let cls = "";
      if (/^(AA|KK|QQ|JJ|TT|99|88|77|66|55|44|33|22)$/.test(cell)) cls = "premium";
      else if (cell.endsWith("s")) cls = "suited";
      else if (cell.endsWith("o")) cls = "offsuit";
      if (/^[JQKA][JQKA][so]?$/.test(cell)) cls += " broadway";
      if (/^[2-9][2-9]s$/.test(cell)) cls += " connector";
      return `<td class="${cls}" data-hand="${cell}" onclick="showPopup('${cell}')">${cell}</td>`;
    }).join('') + "</tr>";
  }

  result.innerHTML = html + "</table>";
  currentTableHTML = result.innerHTML;
}

function showPopup(hand) {
  const popup = document.getElementById("popupBox");
  const data = evData[hand];
  if (data) {
    popup.innerHTML = `<strong>${hand}</strong><br>EV: ${data.ev} BB<br>勝率: ${data.winRate}%<br>${data.note || ''}`;
  } else {
    popup.innerHTML = `<strong>${hand}</strong><br>データなし`;
  }
  popup.style.display = 'block';
  setTimeout(() => popup.style.display = 'none', 3000);
}

window.addEventListener("DOMContentLoaded", updateVsPositionVisibility);
</script>
</body>
</html>
